---
name: bidding-meta-cognition
description: |
  능동적 메타 분석 스킬 - AI가 먼저 생각하고 검증하고 발견하는 단계

  핵심 기능:
  1. 요인별 통계 검증 (발주처/월/금액/지역) - 실제 데이터로 p-value 계산
  2. 다중 전략 생성 (보수/공격/균형/상황맞춤) - 하나의 답이 아닌 여러 선택지
  3. 능동적 패턴 발견 - 사용자가 묻기 전에 이상 패턴/상관관계 탐지
  4. 신뢰도 평가 - 현재 상황에 과거 데이터가 적합한지 판단

  실행 시점:
  - bidding-master-pipeline의 Stage 4-4에서 자동 실행
  - Stage 4-1 (logic), 4-2 (advanced) 결과를 받아서 메타 분석 수행

  출력:
  - meta_analysis_{투찰률}.json - 검증 결과, 전략들, 발견된 인사이트
  - 파이프라인 보고서에 통합됨

  설계 철학:
  "매번 같은 답을 내놓지 않는다"
  - 상황(금액, 발주처, 월)이 다르면 답도 달라야 함
  - 데이터가 부족하거나 맞지 않으면 "불확실"이라고 말해야 함
  - 하나의 공식이 아니라 여러 전략을 제시해야 함

allowed-tools:
  - read
  - write
  - bash
---

# 입찰 메타 인지 분석 스킬

## 개요

기본 분석(logic)과 고급 분석(advanced)의 결과를 받아서:
1. **의심하기**: 이 결과가 현재 상황에 맞나?
2. **검증하기**: 실제 데이터로 통계 검정
3. **발견하기**: 놓친 패턴 찾기
4. **제안하기**: 여러 전략 제시

## 사용법

### 자동 실행 (파이프라인)
```bash
# 낙찰가분석 실행 시 자동으로 Stage 4-4에서 실행됨
낙찰가분석
```

### 수동 실행
```bash
python meta_analyze.py \
  --data-file /mnt/a/25/data전처리완료/투찰률_87_745%_데이터.xlsx \
  --basic-result /mnt/a/25/data분석/bidding_analysis_87745.json \
  --advanced-result /mnt/a/25/data분석/bidding_analysis_advanced_87745.json \
  --context '{"기초금액": 65527000, "발주처": "국가유산청", "월": 12}'
```

## 분석 프로세스

### 1단계: 요인 검증 (Factor Validation)
```python
# 실제 데이터로 통계 검증
발주처별 차이: ANOVA (p-value)
월별 차이: Kruskal-Wallis (p-value)
금액별 상관: Pearson Correlation (r, p-value)
지역별 차이: Chi-square (p-value)

→ p < 0.05이면 "유의미"
→ 효과 크기(effect size) 계산
```

### 2단계: 전략 생성 (Strategy Generation)
```python
# 여러 전략 생성
전략 A (보수): 경쟁 밀도 최소화
전략 B (공격): 수익률 최대화
전략 C (균형): 기대값 최적화
전략 D (맞춤): 검증된 요인 반영

→ 각 전략마다 입찰률, 근거, 리스크 제시
```

### 3단계: 패턴 발견 (Insight Discovery)
```python
# 능동적으로 탐색
이상 패턴: 최근 3개월 추세 변화
숨은 상관: 예상 못한 변수 간 관계
위험 구간: 갑자기 경쟁 밀도 증가한 구간
기회 영역: 비어있는 저경쟁 구간

→ 사용자가 요청 안 해도 발견 제시
```

### 4단계: 신뢰도 평가 (Confidence Assessment)
```python
# 현재 상황 vs 과거 데이터
데이터 충분성: 샘플 수 > 30?
컨텍스트 매칭: 금액/발주처/월 유사도
시간적 유효성: 최근 데이터 비중
이상치 탐지: 현재 상황이 극단값?

→ 신뢰도 점수 (0~1)
→ 0.5 미만이면 "불확실" 경고
```

## 출력 예시

```json
{
  "메타분석_결과": {
    "검증된_영향요인": [
      {
        "요인": "발주처",
        "통계_검정": "ANOVA",
        "p_value": 0.023,
        "유의미": true,
        "효과크기": "0.3%p",
        "인사이트": "국가유산청은 평균 대비 +0.15%p 높음"
      },
      {
        "요인": "월",
        "통계_검정": "Kruskal-Wallis",
        "p_value": 0.12,
        "유의미": false,
        "인사이트": "계절별 차이 통계적으로 유의미하지 않음"
      }
    ],
    "생성된_전략": [
      {
        "전략명": "보수적",
        "입찰률": 99.5,
        "입찰금액": 65165350,
        "예상_경쟁자": 86,
        "예상_1위확률": "1.2%",
        "이익률": "0.5%",
        "리스크": "낮음",
        "근거": "경쟁 밀도 최소 구간 선택"
      },
      {
        "전략명": "공격적",
        "입찰률": 99.1,
        "입찰금액": 64927257,
        "예상_경쟁자": 180,
        "예상_1위확률": "0.56%",
        "이익률": "0.9%",
        "리스크": "높음",
        "근거": "수익률 최대화, 경쟁 감수"
      }
    ],
    "능동적_발견": [
      {
        "카테고리": "이상_패턴",
        "내용": "최근 3개월 국가유산청 입찰률 +0.3%p 상승 추세",
        "중요도": "높음"
      },
      {
        "카테고리": "기회_영역",
        "내용": "99.15~99.25% 구간 경쟁자 44명 (평균 대비 -65%)",
        "중요도": "중간"
      }
    ],
    "신뢰도_평가": {
      "전체_신뢰도": 0.72,
      "평가": "보통",
      "근거": {
        "데이터_충분성": 0.95,
        "컨텍스트_매칭": 0.68,
        "시간적_유효성": 0.75,
        "이상치_여부": false
      },
      "권장사항": "과거 패턴 참고 가능하나, 발주처 특성 고려 필요"
    },
    "최종_추천": {
      "전략": "균형형 (보수-공격 절충)",
      "입찰률": 99.3,
      "신뢰도": 0.72,
      "이유": "발주처 특성(+0.15%p) 반영 + 경쟁 밀도 회피"
    }
  }
}
```

## 기본 분석과의 차이

| 항목 | 기본 분석 (logic) | 메타 분석 (meta-cognition) |
|------|-------------------|----------------------------|
| 목적 | 최적 입찰률 계산 | 결과 검증 및 대안 제시 |
| 출력 | 1개 답 | 여러 전략 + 신뢰도 |
| 접근 | 데이터 → 공식 | 데이터 → 검증 → 의심 → 대안 |
| 상황 고려 | 없음 (항상 같은 답) | 있음 (상황에 따라 다른 답) |
| 불확실성 | 표시 안 함 | 명시적으로 표시 |

## 설계 원칙

1. **실제 데이터만 사용**: 가정이나 임의값 금지, 모든 수치는 통계 검정 결과
2. **여러 관점 제시**: 하나의 정답이 아닌 여러 전략 제시
3. **능동적 탐색**: 사용자가 묻기 전에 패턴 발견
4. **솔직한 평가**: 데이터 부족/맞지 않으면 "불확실" 명시

## 참고

- 기본 분석: `.claude/skills/logic/`
- 고급 분석: `.claude/skills/bidding-advanced-analyzer/`
- 파이프라인: `.claude/skills/bidding-master-pipeline/`
