---
name: bidding-master-pipeline
description: "낙찰가분석,분석해줘,데이터분석,분석" 한마디로 전체 파이프라인 자동 실행. 이미지 업로드 → 데이터 추출 → 전처리 → 분석 → 결과 생성까지 완전 자동화된 마스터 파이프라인
allowed-tools:
  - Read
  - Write
  - Bash
  - Glob
  - Skill
  - mcp__ide__executeCode
---

# Bidding Master Pipeline

## 목적

**"낙찰가분석"** 한마디로 전체 입찰 분석 프로세스를 원스톱 자동 실행합니다.

```
사용자: "낙찰가분석"
     ↓
[이미지 감지] → [데이터 추출] → [전처리] → [분석] → [결과 생성]
     ↓
완료!
```

## 트리거 조건

사용자가 다음 중 하나를 입력할 때 이 스킬이 자동 실행됩니다:
- "낙찰가분석"
- "입찰 분석"
- "파이프라인 실행"

## 실행 단계

### Stage 1: 이미지 감지 및 데이터 추출

**입력:** `/mnt/a/25/data분석/` 폴더의 이미지 파일

**처리:**
1. Glob tool로 이미지 파일 감지 (*.png, *.jpg, *.jpeg)
2. Read tool로 이미지 읽기 (Claude Vision)
3. 입찰 정보 추출:
   - 공고번호
   - 기초금액
   - 투찰률 (발주처투찰률)
   - 예가범위
   - 담당기관
   - 기타 입찰 정보

**출력:** 구조화된 데이터 (dictionary)

### Stage 2: Excel 파일 생성

**입력:** Stage 1의 구조화된 데이터

**처리:**
1. Python으로 Excel 파일 생성
2. 나라장터 형식에 맞게 컬럼 구성:
   - 공고번호
   - 기초금액
   - 예정가격 (계산 필요 시)
   - 투찰금액
   - 발주처투찰률
   - 기타 필요 정보

**출력:** `/mnt/a/25/data/공고번호.xlsx`

### Stage 3: 데이터 전처리

**입력:** `/mnt/a/25/data/` 폴더의 Excel 파일

**처리:**
1. Skill tool로 `data-preprocessing` 스킬 실행
2. 자동으로 다음 작업 수행:
   - 파일 쌍 검증
   - 회사명 정규화
   - 15개 컬럼 표준화
   - 5명 이상 참여 필터링
   - 투찰율별 분리 (9개 파일)

**출력:** `/mnt/a/25/data전처리완료/`
- `전체_통합_데이터.xlsx`
- `투찰률_86_745%_데이터.xlsx` (최다)
- `투찰률_87_745%_데이터.xlsx`
- `투찰률_88_000%_데이터.xlsx`
- 기타 6개 투찰율별 파일

### Stage 4: 종합 분석 실행

**입력:** `/mnt/a/25/data전처리완료/` 폴더의 투찰율별 파일

**처리:**
1. 해당 투찰율 그룹 파일 선택
2. Bash tool로 분석 스크립트 순차 실행:

   **Stage 4-1: 기본 분석**
   - `logic/analyze.py` 실행
   - 9단계 기본 분석 (경쟁 밀도, 몬테카를로, 최적화)
   - 출력: `bidding_analysis_82995.json`, `balance_graph_82995.png`, `heatmap_82995.png`

   **Stage 4-2: 고급 분석** ⭐ NEW
   - `bidding-advanced-analyzer/advanced_analyze.py` 실행
   - Phase 1 심층 분석 (시간대별, 발주처별, 2D 상관관계)
   - 출력: `bidding_analysis_advanced_82995.json`, `2d_correlation_82995.png`

   **Stage 4-3: 통합 보고서**
   - `report` 스킬 실행
   - 기본 분석 + 고급 분석 통합
   - 한글 보고서 생성

**출력:** `/mnt/a/25/data분석/`
- `bidding_analysis_82995.json` (기본 분석)
- `bidding_analysis_advanced_82995.json` (고급 분석) ⭐
- `balance_graph_82995.png` (균형점 그래프)
- `heatmap_82995.png` (경쟁 밀도 히트맵)
- `2d_correlation_82995.png` (2D 상관관계) ⭐
- `/mnt/a/25/data분석/분석결과/입찰_분석_보고서_82995.md` (통합 보고서)

## 실행 예시

```bash
# 사용자 입력
낙찰가분석

# Claude 자동 실행
[Stage 1] 이미지 감지: 스크린샷 2025-10-26 130534.png 발견
[Stage 1] 데이터 추출 완료:
  - 공고번호: R25BK01110791-001
  - 기초금액: 39,000,000원
  - 투찰률: 87.745%

[Stage 2] Excel 생성: /mnt/a/25/data/R25BK01110791-001.xlsx

[Stage 3] 데이터 전처리 실행...
  ✓ 투찰률_87_745%_데이터.xlsx 생성

[Stage 4-1] 기본 분석 실행...
  ✓ 9단계 피라미드 분석 완료
  ✓ 최적 입찰률 계산: 87.843%
  ✓ 균형점 그래프 생성
  ✓ 경쟁 밀도 히트맵 생성

[Stage 4-2] 고급 분석 실행... ⭐ NEW
  ✓ 시간대별 패턴 분석 (+0.3~0.5% 개선)
  ✓ 발주처별 특성 분석 (+0.2~0.4% 개선)
  ✓ 2D 상관관계 분석 (+0.5~1.0% 개선)
  ✓ 2D 히트맵 생성

[Stage 4-3] 통합 보고서 생성...
  ✓ 기본 분석 + 고급 분석 통합
  ✓ 한글 보고서 생성 완료

완료! 결과:
  - JSON: /mnt/a/25/data분석/bidding_analysis_87745.json
  - 고급 JSON: /mnt/a/25/data분석/bidding_analysis_advanced_87745.json
  - 보고서: /mnt/a/25/data분석/분석결과/입찰_분석_보고서_87745.md
  - 총 개선 효과: 기대 1위 확률 +1.0~1.9% ⭐
```

## 에러 핸들링

### 이미지 없음
- `/mnt/a/25/data분석/` 폴더에 이미지가 없으면 안내 메시지 출력
- 사용자에게 이미지 업로드 요청

### 데이터 추출 실패
- 이미지가 입찰 정보가 아닌 경우 감지
- 사용자에게 올바른 이미지 업로드 요청

### 전처리 실패
- data-preprocessing 스킬 에러 시 로그 출력
- 사용자에게 원본 데이터 확인 요청

### 분석 실패
- 분석 스킬 에러 시 중간 결과까지 저장
- 에러 로그와 함께 사용자에게 보고

## 로깅

모든 실행 단계는 `/mnt/a/25/data분석/pipeline_log.txt`에 기록됩니다:

```
[2025-10-26 13:05:34] 파이프라인 시작
[2025-10-26 13:05:35] Stage 1: 이미지 감지 완료
[2025-10-26 13:05:40] Stage 2: Excel 생성 완료
[2025-10-26 13:05:50] Stage 3: 전처리 완료
[2025-10-26 13:06:30] Stage 4: 분석 완료
[2025-10-26 13:06:31] 파이프라인 종료 (실행시간: 57초)
```

## 중요 참고사항

1. **이미지 형식**: PNG, JPG, JPEG 지원
2. **이미지 내용**: 나라장터 입찰 공고 정보 화면
3. **자동 실행**: 사용자 추가 입력 없이 완전 자동
4. **결과 위치**: `/mnt/a/25/data분석/분석결과/`
5. **투찰율 그룹**: 자동으로 해당 투찰율 그룹 선택하여 분석

## 관련 스킬

- `data-preprocessing`: Stage 3에서 자동 호출
- `core`: 핵심 용어 및 철학 정의
- `logic`: Stage 4-1에서 자동 호출 (기본 분석)
- `bidding-advanced-analyzer`: Stage 4-2에서 자동 호출 (고급 분석) ⭐ NEW
- `report`: Stage 4-3에서 자동 호출 (통합 보고서)

## 파이프라인 흐름도

```
사용자: "낙찰가분석"
  ↓
┌─────────────────────────────────────────┐
│ Stage 1: 이미지 감지 & 데이터 추출        │
│  - Glob: *.png, *.jpg 감지              │
│  - Read: Claude Vision으로 정보 추출    │
│  - 출력: 구조화된 데이터                 │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Stage 2: Excel 파일 생성                 │
│  - Python: 나라장터 형식 Excel 생성      │
│  - 출력: /mnt/a/25/data/공고번호.xlsx   │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Stage 3: 데이터 전처리                   │
│  - Skill: data-preprocessing            │
│  - 출력: 9개 투찰률별 파일               │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Stage 4-1: 기본 분석                     │
│  - Bash: logic/analyze.py               │
│  - 9단계 분석 (경쟁 밀도, 몬테카를로)    │
│  - 출력: JSON + 그래프 2개               │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Stage 4-2: 고급 분석 ⭐ NEW              │
│  - Bash: advanced_analyze.py            │
│  - Phase 1 심층 분석 (3가지)            │
│  - 출력: 고급 JSON + 2D 히트맵          │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Stage 4-3: 통합 보고서                   │
│  - Skill: report                        │
│  - 기본 + 고급 분석 통합                │
│  - 출력: 한글 보고서 MD                 │
└─────────────────────────────────────────┘
  ↓
완료! (총 5단계 자동 실행)
```

## 업데이트 이력

- **2025-10-27**: 고급 분석 스킬 통합 ⭐
  - Stage 4를 4-1, 4-2, 4-3으로 세분화
  - `bidding-advanced-analyzer` 스킬 자동 실행 추가
  - 기대 효과: 1위 확률 +1.0~1.9% 개선
- 2025-10-26: 초기 생성 - "낙찰가분석" 원스톱 파이프라인 구축
